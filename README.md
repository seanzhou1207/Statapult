# Building a Statapult Firing Table using a Fractional Factorial Design

<img src="images\large445332.jpeg" alt="Kitten" title="Figure 1" width="400" height="400" />

Statapult used in the experiment 

## Executive Summary
For this project, we tried to use a $2_{IV}^{4-1}$ fractional factorial design to investigate the impact of four variables (pull back angle, release angle, cup position, and eye hook position) and their interactions on the firing range of a statapult. The first fraction of the design did not reveal any statistically significant main effects, but we suspected that the four main effects were the most important. We then folded the design on factor A and attempted to break all the alias chains. However, due to an error in the randomization process, we ended up using the wrong design matrix for the second fraction, which resulted in a loss of orthogonality and a new alias structure for the full model. Despite this issue, the model still had $R^2$ values above 90%, which indicated that it was able to predict range variability with a good level of accuracy. We used this model to generate a regression equation and, under the assumption of sparsity of effects, the results supported our hypothesis and showed that pull back angle, release angle, cup position, and eye hook position were the only statistically significant effects. Finally, we used an iterative process to identify the combinations of factor settings that minimized variance for each target range. In shoot-off tests, our firing table produced consistent shots with low standard errors, but it was not very accurate at mid to long ranges.

## Introduction
A statapult is a device that uses a rubber band to launch projectiles at a controlled velocity. It has been used in a variety of applications, including physics education and ballistics testing. In this experiment, we sought to design a controlled experiment to build a statapult firing table that could be used to launch projectiles accurately and consistently when given a target.
The purpose of this experiment was to determine the main effects and interaction effects of different adjustable factors on the accuracy and consistency of statapult launches. Here are the six factors and their respective range of adjustments on our statapult:
1.	**Pull Back Angle**: 90 degrees – 180 degrees
2.	**Release Angle**: 1 – 6
3.	**Cup Position**: 1 – 5
4.	**Eye Hook Position**: 2-6
5.	**Tension Arm Position**: 1 – 4
6.	**Rubber Band used**: Band 1, 2, or 3


<img src="images\445334.jpeg" alt="Kitten" title="Figure 1" width="400" height="400" />


The hypothesis is that regardless of our factor and factor level selections, we can find an optimal combination of them that would give the best performance. Evidently, such combination is not unique. The best setting for a particular target range in one model may give poor performance in another. However, we try to find the minimum variance setting for each target range on our firing table and are tested on our model quality in a final shoot-off. 
The final firing table will specify the exact statapult settings used to hit ranges from 30 to 100 inches in even number increments (i.e., 30'', 32'', 34'',...,100''). In addition, it will also include the prediction variance and a 95% confidence interval for each desired range. 
## Model Selection

To simulate the financial and logistics limitations that exist in an actual experimental design, we are limited to only 20 runs on our statapult. Hence, we apply a $2^{k-p}$ fractional factorial design, a type of experimental design that allows us to study the effects of multiple factors while using fewer experimental runs than a full factorial design. Such design is also more flexible, allowing us to conduct sequential experimentation: we can fold-over our first fraction or project our design onto a lower dimension based on the first-stage results. 

We choose a $2_{IV}^{4-1}$ design. Below is the design summary generated by Minitab. 

<img src="images/Picture1.png" alt="Kitten" title="Figure 2" width="400" height="300" />      <img src="images/Picture2.png" alt="Kitten" title="Figure 2" width="200" height="300" />  

This design is preferred since 1. we have a resolution IV, which at least allows us to isolate the main effects as they are aliased with third order interactions. 2. Although a full fold-over cannot be done, we can easily conduct a partial fold-over on any of the main effects and break up all alias chains. 3. The first half fraction only uses up 8 runs, hence leaving us with sufficient runs to continue our experiment. Such design offers decent variability in our effects while having a relatively easy-to-break aliasing structure. 

Our factor selections are as follows:
| Factor   | Variable?|	Selection|Center Point|
|----------|----------|----------|----------|
| Pull Back Angle|Yes |150, 180  |165   
|Release Angle|Yes    |  3, 5|4
|Cup Position|No      |1|2
|Eye Hook Position|Yes|4, 6|5
|Tension Arm Position|Yes|2, 4|3
|Rubber Band|No       |1|N/A

- Pull-back Angle
    - We selected 150 and 180 degrees as our levels. Smaller angles are avoided to ensure a decent level of shooting strength. 
- Release Angle
    - We selected 3 and 5 as our levels. The release angle provides a constraint on the pull-back angle since a small release angle requires a very large pull-back angle. We would not be able to utilize the full range of our pull-back angle if we choose small release angles. 
    - 3 should give us maximum firing strength as the release angle would roughly equal 45 degrees. 
    - 5 should give us a direct shot with no arc, which helps us hit the closer targets.
- Cup position
    - We selected 1 as our constant level. We found that if we were to use cup position as a variable, levels 1 and 2 are the only feasible options given our set up on the other factors as cup position 3 would give us a dangerous firing trajectory that might hit the vertical lever. We determined that levels 1 and 2 are not so much different.  
- Eye Hook Position
    - We selected 4 and 6 as our levels. These levels must be greater than the cup position levels, ensuring that the ball successfully launches. 
-  Tension Arm Position
    - We selected 2 and 4 as our levels to ensure we have enough tension from the rubber band
- Rubber Band
    - This is kept constant because we believe it is the least influential factor compared to the other five. In addition, we are only allowed 20 observations, which forces us to eliminate some factors. 

## Data Collection Process
Clearly stating the data collection procedure is crucial, as any inconsistency in the procedure could lead to large measurement errors. We break up the process into three stages: set-up, launch, and measurement.

In the set-up stage, we refer to our design table to set the individual factors to their pre-determined level. However, we still noted a few areas that call for the experimenter’s close attention. First, when applying the rubber band to the eye hook, we ensured that the band loops through the hook and pulled it as tight as possible. A tight loop and a loose loop could drastically impact the amount of tension applied. Second, we ensured that the band was not tangled up or twisted for similar consistency in tension. Third, we aligned the eyehook in the same direction for all runs. The set-up process for other factor levels is relatively straight-forward.

For the launch process, I decided to use my thumb and index finger for pull-back and release. My original plan of replacing my fingers with a string was abandoned after discovering that the string’s fragile nature makes it harder to reach the target angle and stabilize the pull-back. 

I had multiple classmates help me record the point of contact using a slow-motion camera. To begin, I would inform them the approximate range so that their cameras can zoom into that area. After a brief count-down, I launch the ball. They would then slow down the footage and give me a range estimate for the first hit. Finally, I take the average of their proposed number and record it into my dataset. Prior experience demonstrated that this camera approach is the only realistic measuring method given the velocity of the ball.  

## Experimentation and Statistical Analysis
|RunOrder|	CenterPt	|Blocks	|Pull-back angle|Release angle	|Eye hook position	|Tension arm	| Range |
|----------|----------|----------|-------|----------|----------|----------|----------| 
|1	     |       1	  |      1	|    180	|    3	 |       4	  |          2	    |            112|
|2	     |       1	  |      1	|    150	|    5	 |       6	  |          4	    |            28|
|3	     |       1	  |      1	|    180	|    5	 |       6	  |          4	    |            45|
|4	     |       1	  |      1	|    180	|    5	 |       6	  |          4	    |            42|
|5	     |       1	  |      1	|    150	|    5	 |       4	  |          4	    |            31|
|6	     |       1	  |      1	|    150	|    3	 |       4	  |          2	    |            62|
|7	     |       1	  |      1	|    180	|    3	 |       6	  |          2	    |            84|
|8	     |       1	  |      1	|    150	|    3	 |       6	  |          4	    |            24|
|9	     |       1	  |      1	|    150	|    5	 |       6	  |          2	    |            36|
|10	     |       1	  |      1	|    180	|    5	 |       4	  |          2	    |            64|
|11	     |       1	  |      1	|    180	|    3	 |       4	  |          4	    |            72|

Above are the run order and results from the first fraction. Our first two runs serve as a preliminary range test. As we have no knowledge of the possible firing ranges that could be achieved based on our factor settings, we need to set up a basis to see if our range is far or close enough to fill out a complete firing table. If these runs fail to reach our desired range (30 to 100 inches), we adjust the factor levels accordingly. As shown, the two settings successfully reached the maximum and minimum values within our target range. Therefore, no adjustment was needed to our pre-determined factor levels. 

The next nine runs come from the first half fraction of our design. The run order is randomized to spread out the potential noise induced by time. The randomization process is carried out in Minitab. Run 4 was needed as confirmation for run 3, as my partner could not obtain a reliable reading for run 3. We conduct statistical analysis on our first fraction and obtain the following results: 

|Term	|Effect	|Coef|
|----|----|----|
|Constant	| |	51.88|
|Pull-back angle (A)|	27.25	|13.63
|Release angle (B)|	-17.250|	-8.625|
|Eye hook position (C)|	-10.750|	-5.375|
|Tension arm (D)|	-19.250|	-9.625|
|Pull-back angle*Release angle|	-7.750|	-3.875|
|Pull-back angle*Eye hook position|	5.750|	2.875|
|Pull-back angle*Tension arm|	2.250|	1.125| 

<img src="images\Picture3.jpg" alt="Kitten" title="Figure 1" width="600" height="400" />

From the normal plot, we observe no statistically significant effects. However, the absolute value of effects A, B, C, and D are greater than 10, so we determine these to be our initial factors of interest. As discussed above, a full fold-over only adds replicated runs and does not work on a design with resolution IV. We decided to fold over on factor A (pull-back angle) and break all alias chains, which would yield the following design:

<img src="images\Design Summary.jpg" alt="Kitten" title="Figure 1" width="500" height="400" />

Unfortunately, we generated an erroneous design matrix after the fold-over. To obtain the full design, we used the web-version of Minitab and created the same factorial design except folding over on factor A. However, we did not specify a base number for the random data generator – entering the base number would have used the same seed and applied the same randomization on run orders as our first fraction. Instead, Minitab automatically reassigned the run orders for *all 16 runs* under a separate randomization process. Unknowingly, I followed the design matrix of the second fraction and conducted the experiments, eventually recording duplicated entries for the same settings. The error was discovered when I analyzed the full factorial model, after the experiment day. 

This mistake has several significant consequences. First, our full design is no longer orthogonal. The model is now more responsive to elimination or addition of factors because our factors are dependent on each other. For example, if we decide to add in “ball type” as another control variable, the effects and ANOVA results on other factors of interests would change based on their interactions with ball type. This makes our results less reliable. Moreover, we cannot estimate the effects of ABD, BCD, ABCD interactions due to the replicated entries. The alias chain now becomes: 

|Alias Chain|   | |
|-|-|-|
|I + ABCD	|AD + ABD - BCD - ABCD|	AC - ABD + BCD + ABCD|
|A + BCD	|BC - ABD + BCD + ABCD| |
|B + BCD	|BD + ABD - BCD - ABCD| |
|C + ABD	|CD - ABCD| |
|D - ABD	|ABC + ABD| |
|AB + ABCD	|ACD - BCD| |

The alias chain adds difficulty for isolating the significant effects. Main effects A, B are aliased with factor BCD; main effects C, D are aliased with factor ABD. Thus, we invoke the sparsity of effects principle and ignore all third-or higher order effects. Such approach is not ideal as past research shows that the higher order interaction terms in statapult settings are likely to be significant. However, it allows us to extract some interpretations from our results:  

### Coded Coefficients

| Term                                 | Effect  | Coef  | SE Coef | T-Value | P-Value |
|----------------------|---------|-------|---------|---------|---------|
| Constant                             |         | 50.60 | 2.36    | 21.43   | 0.000   |
| Pull-back angle                      | 29.21   | 14.60 | 2.36    | 6.19    | 0.000   |
| Release angle                        | -11.29  | -5.65 | 2.15    | -2.63   | 0.034   |
| Eye hook position                    | -11.54  | -5.77 | 2.36    | -2.44   | 0.044   |
| Tension arm                          | -26.00  | -13.00| 2.59    | -5.03   | 0.002   |
| Pull-back angle * Release angle      | -7.04   | -3.52 | 2.15    | -1.64   | 0.145   |
| Pull-back angle * Eye hook position  | -2.04   | -1.02 | 3.36    | -0.30   | 0.770   |
| Pull-back angle * Tension arm        | -11.25  | -5.63 | 3.52    | -1.60   | 0.155   |
| Release angle * Eye hook position    | 10.21   | 5.10  | 3.50    | 1.46    | 0.188   |
| Release angle * Tension arm          | 4.50    | 2.25  | 3.39    | 0.66    | 0.528   |
| Eye hook position * Tension arm      | -3.25   | -1.63 | 2.59    | -0.63   | 0.550   |
| Pull-back angle * Release angle * Eye hook position | 5.96   | 2.98  | 2.15    | 1.39    | 0.208   |
| Pull-back angle * Eye hook position * Tension arm   | -4.00  | -2.00 | 2.59    | -0.77   | 0.465   |

<img src="images\Norm Plot of std effect.jpg" alt="Kitten" title="Figure 1" width="600" height="400" />

### Analysis of Variance
| Source                                    | DF | Adj SS | Adj MS  | F-Value | P-Value |
|---------------------------|----|--------|---------|---------|---------|
| Model                                     | 12 | 12746.8| 1062.23 | 17.37   | 0.000   |
|   Linear                                  | 4  | 10247.4| 2561.84 | 41.88   | 0.000   |
|     Pull-back angle                       | 1  | 2340.0 | 2340.00 | 38.26   | 0.000   |
|     Release angle                         | 1  | 422.1  | 422.07  | 6.90    | 0.034   |
|     Eye hook position                     | 1  | 365.4  | 365.38  | 5.97    | 0.044   |
|     Tension arm                           | 1  | 1545.1 | 1545.14 | 25.26   | 0.002   |
|   2-Way Interactions                      | 6  | 1691.5 | 281.91  | 4.61    | 0.033   |
|     Pull-back angle * Release angle       | 1  | 164.1  | 164.14  | 2.68    | 0.145   |
|     Pull-back angle * Eye hook position   | 1  | 5.6    | 5.64    | 0.09    | 0.770   |
|     Pull-back angle * Tension arm         | 1  | 155.8  | 155.77  | 2.55    | 0.155   |
|     Release angle * Eye hook position     | 1  | 129.9  | 129.92  | 2.12    | 0.188   |
|     Release angle * Tension arm           | 1  | 27.0   | 27.00   | 0.44    | 0.528   |
|     Eye hook position * Tension arm       | 1  | 24.1   | 24.14   | 0.39    | 0.550   |
|   3-Way Interactions                      | 2  | 135.6  | 67.78   | 1.11    | 0.382   |
|     Pull-back angle * Release angle * Eye hook position   | 1  | 117.5  | 117.52  | 1.92    | 0.208   |
|     Pull-back angle * Eye hook position * Tension arm     | 1  | 36.6   | 36.57   | 0.60    | 0.465   |
| Error                                     | 7  | 428.2  | 61.17   |         |         |
| Total                                     | 19 | 13174.9|         |         |         |

We see that A, B, C, D main effects are now statistically significant, consistent with our original hypothesis. The model still accounts for major variabilities in firing range with $R^2$ and adjusted $R^2$ values of 96.75% and 91.18%, respectively. We only estimate 12 factors here, which give us 19-12=7 degrees of freedom for error. This drastically reduced our MSE and increased our model power. 

## Regression and Building the Firing Table
Our regression equation in uncoded units from the full model is: 

$E(Range) = -637 + 5.35  \text{A} + 165  \text{B} + 55  \text{C} - 62  \text{D} - 1.228  \text{A}  \text{B}$
$- 0.463  \text{A}  \text{C} + 0.292  \text{A}  \text{D} - 27.7  \text{B}  \text{C} + 2.25  \text{B}  \text{D}$
$+ 20.4  \text{C}  \text{D} + 0.199  \text{A}  \text{B}  \text{C}$
$- 0.133  \text{A}  \text{C}  \text{D}$


Since 1. the only continuous variable factor in our model is the pull-back angle, and 2. our results show that pull back angle has the largest effect, we choose to use it to finetune the desired firing ranges. The table building process is carried out using Python. We start by encoding our variables in design matrix into ${-1, 1}$ and inputting the regression equation in coded terms. Then for each range target, we use our dataset to search for settings with measured ranges at most 10 inches from our target. For example, for a target of 36 inches, we choose data with measured ranges in $[26, 46]$. We solve for the pull back angle holding other variables fixed. We calculate the variance using the variance formula for predictions:
$$V( Y(X_0 ))= MSE×(1+X_0^T (X^T X)^{-1} X_0)$$
Where $X_0$ is a vector of our factor settings. We iteratively calculate all variances under the desired range and select the minimum variance factor settings subject to the restriction that the uncoded pull-back angle is between 140 and 180 degrees. Finally, we use MiniTab to obtain the 95% confidence intervals. See appendix for the full firing table. 

The shoot-off performance of our firing table is as follows:

| Target 1: 34" |        |       |       | Target 2: 66" |       |       |       | Target 3:  96" |       |       |       | Overall |       |
|-------|-------|-------|-------|-------|-------|-------|-------|-------------|-------|-------|-------|---------|----------|
| Attempt       |       |       | StDev   | Attempt       |       |       | StDev | Attempt     |       |       | StDev  |   StDev        |          |
| 1             | 2     | 3     | Abs Error | 1             | 2     | 3     | Abs Error   | 1   | 2     | 3     | Abs Error|  Abs Error       |          |
| 34            | 34    | 33    | 0.577 | 43            | 46    | 42    | 2.082 | 87      | 81    | 84    | 3     | **1.89**    |          |
| 0             | 0     | 1     | 0.333 | 23            | 20    | 24    | 22.33 | 9      | 15    | 12    | 12    | **11.56**   |          |

 When the target range is short, our firing table was extremely accurate and consistent. The high release angle of 5 allowed the statapult to get a direct and powerful hit in close ranges. However, its accuracy in medium to long ranges is unsatisfactory. This can also be explained by the factor level selections. For example, it is difficult to reach sufficient range with a release angle of 5, as even the most powerful shots did not have the arc to be launched far. Standard deviations across each set of three attempts were low, indicating that the firing table generates consistent results. This may be attributed to our large ${df}_{error}$ and thus small MSE, leading to low variances of our predictions. 
 ## Conclusions
 The study could be improved in numerous ways. Evidently, we could have double-checked our design matrix for the second fraction. With the correct orthogonal design and no alias structure, our model could gain more predictability as we would be able to estimate the interaction effects. We could also choose to implement a different model design, such as a full $2^4$ factorial with center points. Given that we already restrict our design to four factors, we have sufficient runs for a more complete design with no alias structures. Shoot-off results showed that a simple $2^4$ design by one of my classmates generated the most accurate firing table. 

Additionally, we had $20-2^4=4$ extra runs and used two of them for initial range testing and the other two for measurement confirmation. We could use more caution in data collection process, sparing the two runs to add center points to our design. Center points can provide more precise estimates of the mean range response than estimates based on only the extreme levels of our factors. This can be especially useful when the response surface is nonlinear. They could help to identify potential curvature in the response surface and thus improve the robustness and generalizability of the model. 

Finally, we could derive our firing table differently. For example, we could add other metrics other than prediction variances to determine the optimal factor settings for a target range. We could place larger weights on factor settings with measured ranges closer to our target and vice versa. The resulting table may be more accurate as we are interpolating within closer regions. 

In conclusion, we attempted to use a $2_{IV}^{4-1}$ fractional factorial to analyze the effects of pull back angle, release angle, cup position and eye hook position as well as their interactions on the firing range of a statapult. The first fraction showed no statistically significant main effects, but we hypothesized the four main effects to be the most substantial. We folded over the design on factor A and tried to break all alias chains. However, due to different randomization processes, we created the wrong design matrix for the second fraction and unknowingly used it to collect data. This caused us to lose orthogonality and led to a new alias structure for the full model. Nevertheless, with $R^2$ values of over 90%, the model offered sufficient predictability in range variability, so we used it to generate our regression equation. Under the sparsity of effects assumption, the results confirmed our hypothesis and showed that pull back angle, release angle, cup position and eye hook position are the only statistically significant effects. Lastly, we obtained optimal factor settings for each target range by iteratively finding the minimum variance combinations. In shoot-off, our firing table yielded consistent shots with low standard errors but lacked accuracy in mid to long ranges. 

## References
Montgomery, Douglas C. Design and Analysis of Experiments. New York :Wiley, 1984.

Sodersens. (n.d.). Statapult Air Academy Associates. Retrieved from https://sodersens.se/objekt/statapult-air-acadamy-accociates/159892

## Appendix
See [this](appendix/Appendices.pdf)